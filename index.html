<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Config Check</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use Inter font */
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div id="app-container" class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg transition-all duration-300">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">Firebase Status Checker</h1>
        <p class="text-center text-gray-600 mb-8">Initializing Firebase with your provided configuration and signing in...</p>

        <!-- Status Display Area -->
        <div id="status-card" class="bg-indigo-50 border-l-4 border-indigo-500 text-indigo-900 p-4 rounded-lg">
            <p id="status-message" class="font-medium">Loading...</p>
        </div>

        <!-- Details Display Area -->
        <div id="details-section" class="mt-6 space-y-4 hidden">
            <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-inner">
                <p class="text-sm font-semibold text-gray-500">Canvas App ID</p>
                <code id="app-id-display" class="block mt-1 text-sm text-gray-800 font-mono break-all"></code>
            </div>
            <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-inner">
                <p class="text-sm font-semibold text-gray-500">Authenticated User ID</p>
                <code id="user-id-display" class="block mt-1 text-base text-green-700 font-mono break-all font-bold"></code>
            </div>
        </div>
        
        <!-- Error Display Area -->
        <div id="error-section" class="mt-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg hidden">
            <p class="font-bold">Error During Initialization</p>
            <p id="error-message" class="mt-1 text-sm"></p>
        </div>
    </div>

    <script type="module">
        // Mandatory imports for Firebase services
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment (using the user's data for configuration)
        // We structure this to follow the mandatory access pattern, providing fallbacks.
        const providedFirebaseConfig = {
            apiKey: "AIzaSyBFwj2eyLRhnolyfXCmEXmPCdBqen5epH4",
            authDomain: "blogs-d6e36.firebaseapp.com",
            projectId: "blogs-d6e36",
            storageBucket: "blogs-d6e36.firebasestorage.app",
            messagingSenderId: "919635572942",
            appId: "1:919635572942:web:58d516d3680b28801eb89f",
            measurementId: "G-8JR0P4VJ03"
        };
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // Use the user's config, but ensure it's accessed via the global structure if available
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : providedFirebaseConfig;
        
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const statusMessage = document.getElementById('status-message');
        const detailsSection = document.getElementById('details-section');
        const appIdDisplay = document.getElementById('app-id-display');
        const userIdDisplay = document.getElementById('user-id-display');
        const errorSection = document.getElementById('error-section');
        const errorMessage = document.getElementById('error-message');

        /**
         * Initializes Firebase and authenticates the user.
         */
        async function initializeFirebase() {
            try {
                statusMessage.textContent = "1. Initializing Firebase application...";
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                getFirestore(app); // Initialize Firestore instance too

                statusMessage.textContent = "2. Attempting user authentication...";

                let userCredential;
                if (initialAuthToken) {
                    // Use custom token if provided by the environment
                    userCredential = await signInWithCustomToken(auth, initialAuthToken);
                    statusMessage.textContent = "3. Successfully signed in with custom token!";
                } else {
                    // Fallback to anonymous sign-in
                    userCredential = await signInAnonymously(auth);
                    statusMessage.textContent = "3. Successfully signed in anonymously (No custom token provided).";
                }

                const userId = userCredential.user.uid;
                
                // Update UI with success details
                document.getElementById('status-card').classList.replace('border-indigo-500', 'border-green-500');
                document.getElementById('status-card').classList.replace('bg-indigo-50', 'bg-green-50');
                document.getElementById('status-card').classList.replace('text-indigo-900', 'text-green-900');
                
                appIdDisplay.textContent = appId;
                userIdDisplay.textContent = userId;
                detailsSection.classList.remove('hidden');

            } catch (error) {
                console.error("Firebase Initialization Error:", error);

                // Update UI to show error
                statusMessage.textContent = "Initialization Failed!";
                document.getElementById('status-card').classList.replace('border-indigo-500', 'border-red-500');
                document.getElementById('status-card').classList.replace('bg-indigo-50', 'bg-red-100');
                document.getElementById('status-card').classList.replace('text-indigo-900', 'text-red-700');
                
                errorMessage.textContent = error.message;
                errorSection.classList.remove('hidden');
            }
        }

        // Run the initialization sequence on load
        window.onload = initializeFirebase;
    </script>
</body>
</html>
